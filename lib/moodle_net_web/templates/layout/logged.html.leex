<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <%= csrf_meta_tag() %>
    <%= live_title_tag assigns[:page_title] || "", suffix: " :: "<>app_name %>
    <link phx-track-static rel="stylesheet" href="<%= Routes.static_path(@conn, "/css/app.css") %>"/>
    <script defer phx-track-static type="text/javascript" src="<%= Routes.static_path(@conn, "/js/app.js") %>"></script>
  </head>
  <body>
  <div id="template" class="page <%= if !@current_user , do: "guest", else: "logged" %>">

    <%= if @current_user do %>

      <nav class="logged__drawer">
        <details class="drawer__profile" >
          <summary class="button user__dropdown">
            <img src="<%= @current_user.icon_url %>" />
            <h3 ><%= @current_user.name %></h3>
          </summary>
            <ul class="dropdown__list">
              <li><a href="/my/profile">Profile</a></li>
              <li><a href="/settings">Settings</a></li>
              <li><a href="#">Logout</a></li>
            </ul>
        </details>
          <div class="drawer__menu">
            <nav class="menu__general">
              <div class="panel__item">
                <a href="/my/timeline">
                  <i class="feather-home"></i> Home
                </a>
              </div>
              <div class="panel__item">
                <a href="/search">
                  <i class="feather-search"></i> Search
                </a>
              </div>
              <div class="panel__item">
                <a href="/">
                  <i class="feather-anchor"></i> My Instance
                </a>
              </div>
              <div class="panel__item">
                <a href="/my/notifications">
                  <i class="feather-bell"></i> Notifications
                </a>
              </div>
            </nav>
            <details>
              <summary>Communities</summary>
              <nav class="general__details">
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                  <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
              </nav>
            </details>
            <details>
              <summary>Direct Messages</summary>
              <nav class="general__details">
                <div class="panel__item">
                <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
                <div class="panel__item">
                <img src="https://picsum.photos/40" /> <h3>ValueFlows UI components</h3>
                </div>
            </nav>
          </details>

            <!-- h3 class="panel__title">Communities</h3 -->
          </div>
          <div class="content__bottom">
            <button class="button new-community">Create a new community</button>
          </div>
      </nav>

    <% end %>

    <%= if @current_user == nil do %>
    <header class="page__header">
      <div class="header__left">
        <a href="/">
          CommonsPub
        </a>
        <input placeholder="Search..." />
      </div>
      <div class="header__right">
        <a class="button" href="/login"><i class="feather-file-text"></i> Login</a>
      </div>
      </header>
    <% end %>

  <section class="page__wrapper">
    <div class="page__mainContent">
    <button class="button-outline-only-icon" aria-expanded="true" aria-controls="drawer">
      <i class="feather-chevrons-left"></i>
    </button>
      <%= @inner_content %>
    </div>
  </section>
</div>
<script>

const drawer = document.getElementById('drawer');
const toggle = document.querySelector('[aria-controls="drawer"]');
const main_template = document.getElementById('template');

function open() {
  toggle.setAttribute('aria-expanded', true);
  main_template.classList.remove('full');
  drawer.classList.add('is-sliding');
  drawer.hidden = false;
  drawer.getClientRects(); // Force re-paint so transition occurs
  drawer.classList.remove('is-sliding');
}

function close() {
  toggle.setAttribute('aria-expanded', false);
  main_template.classList.add('full');
  drawer.classList.add('is-sliding');
  drawer.hidden = true;
  drawer.classList.remove('is-sliding');
}

toggle.addEventListener('click', () => {
  const expanded = toggle.getAttribute('aria-expanded') === 'true';

  if (expanded) {
    close();
  } else {
    open();
  }
});

drawer.addEventListener('click', event => {
  if (event.target === drawer) {
    close();
  }
});
  </script>
  </body>
</html>
